<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>DEMO</title>
    <style>
        * {
            padding: 0;
            margin: 0;
            user-select: none;
        }

        .container {
            background-color: #fafafa;
            border: 1px solid #ccc;
            position: relative;
        }

        .down {
            display: flex;
            margin-top: 20px;
        }

        #container {
            width: 100%;
            height: 400px;
        }

        #freed {
            width: 200px;
            height: 300px;
            margin-right: 30px;
        }

        #leak {
            width: 400px;
            height: 300px;
        }
    </style>
</head>

<body>

    <div class="container" id="container"></div>

    <button id="btn-prev">prev</button>
    <button id="btn-next">next</button>
    <button id="hide">隐藏</button>
    <span id="pos"></span>

    <div class="down">
        <div id="freed" class="container"></div>
        <div id="leak" class="container"></div>
    </div>



    <script src="./../dist/sv.js"></script>
    <script>

        const Group = SV.Group,
            Bound = SV.Bound,
            G6 = SV.G6,
            Vector = SV.Vector;

    </script>
    <script src="./Layouter/LinkList.js"></script>
    <script src="./Layouter/BinaryTree.js"></script>
    <script src="./Layouter/Stack.js"></script>
    <script src="./Layouter/LinkQueue.js"></script>
    <script src="./Layouter/GeneralizedList.js"></script>
    <script src="./Layouter/ChainHashTable.js"></script>
    <script src="./Layouter/Array.js"></script>
    <script src="./Layouter/HashTable.js"></script>
    <script src="./Layouter/LinkStack.js"></script>
    <script src="./Layouter/AdjoinMatrixGraph.js"></script>
    <script src="./Layouter/AdjoinTableGraph.js"></script>
    <script>

        const curSelectData = { element: null, style: null };

        let cur = SV(document.getElementById('container'), {
            freedContainer: document.getElementById('freed'),
            leakContainer: document.getElementById('leak'),
            view: {
                groupPadding: 40,
            },
        });


        let data = [{
            "LinkList0": {
                "data": [
                    {
                        "id": "0x617fb0",
                        "data": "N",
                        "next": "0x617ff0",
                        "rootExternal": [
                            "before"
                        ],
                        "type": "default"
                    },
                    {
                        "id": "0x617ff0",
                        "data": "A",
                        "next": "0x618010",
                        "type": "default"
                    },
                    {
                        "id": "0x618010",
                        "data": "A",
                        "next": "0x618030",
                        "type": "default"
                    },
                    {
                        "id": "0x618030",
                        "data": "B",
                        "next": "0x618050",
                        "type": "default"
                    },
                    {
                        "id": "0x618050",
                        "data": "N",
                        "next": null,
                        "type": "default"
                    }
                ],
                "layouter": "LinkList"
            },
            "LinkList1": {
                "data": [
                    {
                        "freed": true,
                        "id": "0x617fd0",
                        "data": "",
                        "next": "0x605010",
                        "rootExternal": [
                            "tmpNode"
                        ],
                        "type": "default"
                    }
                ],
                "layouter": "LinkList"
            }
        }];



        let dataIndex = 0,
            curData = data[dataIndex];

        cur.render(curData);

        let f = true;
        document.getElementById('hide').addEventListener('click', e => {
            f ? cur.hideGroups(['BinaryTree']) : cur.hideGroups(['LinkList']);
            f = !f;
        });

        document.getElementById('btn-next').addEventListener('click', e => {
            curData = data[++dataIndex];
            cur.render(curData);
            // curSelectData.element = null;
            // curSelectData.style = null;
        });

        document.getElementById('btn-prev').addEventListener('click', e => {
            curData = data[--dataIndex];
            cur.render(curData);
        });

        const container = document.getElementById('container'),
            pos = document.getElementById('pos');

        container.addEventListener('mousemove', e => {
            let x = e.offsetX, y = e.offsetY;
            pos.innerHTML = `${x},${y}`;
        });


        document.getElementById('hide').addEventListener('click', () => {
            cur.selectElement(1000, ele => {
                ele.set('label', '6666');
            });
        });

        // -------------------------------------------------------------------------------------------------------




        /**
         * 选中一个element
         */
        function selectElement(element) {
            if (element === curSelectData.element) {
                return;
            }

            if (curSelectData.element) {
                const style = curSelectData.style;
                curSelectData.element.set("style", style);
            }

            curSelectData.element = element;
            curSelectData.style = { ...element.get("style") };
            this.setSelectElementStyle(element);
        }

        /**
         * 设置选中的节点的颜色
         */
        function setSelectElementStyle(element) {
            element.set("style", {
                fill: "#e23e57",
            });
        }

        cur.on('node:click', ele => {
            selectElement(ele);
        });

    </script>
</body>

</html>